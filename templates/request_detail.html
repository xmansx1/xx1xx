<!DOCTYPE html><html lang="ar" dir="rtl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>تفاصيل الطلب – تطوع من أجلي</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head><body class="bg-slate-50">
<header class="bg-white border-b">
  <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
    <div class="font-extrabold">تفاصيل الطلب</div>
    <nav class="flex gap-3">
      <a href="{% url 'dashboard' %}" class="px-3 py-2 rounded-lg bg-white border">عودة للوحي</a>
      <a href="{% url 'logout' %}" class="px-3 py-2 rounded-lg bg-white border">خروج</a>
    </nav>
  </div>
</header>

<main class="max-w-5xl mx-auto px-4 py-6">
  <div class="bg-white border rounded-xl p-4">
    <div class="flex justify-between items-start">
      <div>
        <h1 class="font-extrabold text-lg">{{ obj }}</h1>
        <div class="text-sm text-slate-600">{{ obj.city }} • {{ obj.date }} {{ obj.time|time:"H:i" }}</div>
      </div>
      <div class="text-sm px-3 py-1 rounded-full border">{{ obj.get_status_display }}</div>
    </div>

    <div class="mt-3 text-sm text-slate-700">{{ obj.desc|linebreaksbr }}</div>

    <div class="grid md:grid-cols-2 gap-4 mt-4">
      <div class="p-3 rounded-xl border">
        <div class="font-bold mb-2">معلومات التواصل</div>
        <div class="text-sm text-slate-700">الاسم: {{ obj.name }}</div>
        <div class="text-sm text-slate-700">الجوال: {{ obj.phone }}</div>
        {% if obj.assigned_to %}
          <div class="text-sm text-slate-700 mt-2">المتطوع المكلّف: {{ obj.assigned_to.name }}</div>
        {% endif %}
        {% if obj.assigned_org %}
          <div class="text-sm text-slate-700">الجهة المكلّفة: {{ obj.assigned_org.name }}</div>
        {% endif %}
      </div>
      <div>
        <div id="map" class="h-64 rounded-xl border"></div>
        <p class="text-xs text-slate-500 mt-2">الموقع تقريبي للعرض.</p>
      </div>
    </div>
  </div>
</main>

<script>
  const lat = {{ obj.lat|default:"null" }};
  const lng = {{ obj.lng|default:"null" }};
  if(lat && lng){
    const map = L.map('map', {scrollWheelZoom:false}).setView([lat, lng], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution:'© OpenStreetMap' }).addTo(map);
    L.marker([lat,lng]).addTo(map).bindPopup('{{ obj.city }}').openPopup();
  } else {
    document.getElementById('map').innerHTML = '<div class="p-4 text-sm text-slate-500">لا تتوفر إحداثيات.</div>';
  }
</script>
</body></html>
